<!DOCTYPE html>
<html>
  <head>
    <title>Place searches</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      
	</style>
	<link href="http://fonts.googleapis.com/css?family=Open+Sans:300,700" rel="stylesheet" />
	<link href="css/styles.css" rel="stylesheet" />
    <script>
	// This example requires the Places library. Include the libraries=places
	// parameter when you first load the API. For example:
	// <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places">

	var map;
	var infowindow;
	var da_class = 'display';
	var number_close_by;
	var total_results = [];
	var all_ids = [];
	
	function initMap() {

		console.log('initMap')

		var city = {lat: 43.653908, lng: -79.3832};

		map = new google.maps.Map(document.getElementById('map'), {
			center: city,
			zoom: 15
		});

		infowindow = new google.maps.InfoWindow();
		var service = new google.maps.places.PlacesService(map);
		service.nearbySearch({
			location: city,
			radius: 500,
			type: ['restaurant']
		}, callback);
	}

	function callback(results, status) {
		
		if (status === google.maps.places.PlacesServiceStatus.OK) {
			total_results = results;
		}
		saveObj();
	}

	function saveObj() {
		for(var i = 0; i < total_results.length; i++){
			var obj = { "name":total_results[i].name.toString(), "address":total_results[i].vicinity.toString(), "rating":total_results[i].rating.toString(), "url":(total_results[i].photos[0].getUrl({'maxWidth': 600, 'maxHeight': 600})).toString()};
			var myJSON = JSON.stringify(obj);
			all_ids.push((total_results[i].place_id).toString());
			localStorage.setItem(total_results[i].place_id, myJSON);
		}
	}

	

    </script>
  </head>
  <body>
	<div id ="main">
		<div id="map"></div>
		<canvas id="myCanvas"></canvas>
	</div>

	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBgRq1iYHYtaAkVf23XJBEAk39R-pAERQw&libraries=places&callback=initMap" async defer></script>
  </body>
</html>